# Bitaxe Persistent Logging (BPL)

Since Bitaxes don't keep track of operational stats by themselves, and the AxeOS webpage _temporarily_ shows _some_ stats _only while you are on it_, I decided to make a more _persistent_ solution for logging _all_ of your Bitaxe's stats in a effortless and easy to read way that doesn't require your presence.

BPL is a simple Node.js Express server that:

- Queries your Bitaxe for stats every 5 seconds via 'GET /api/system/info'
- Logs key details to a .csv file
- Sends a single PNG snapshot containing every stat graphed since boot when the Express server endpoint is accessed

![An example snapshot generated by BPL](/.github/resources/README/snapshot.png)

## Table of Contents

- [Features](#features)
- [Prerequisites](#prerequisites)
- [Installation](#installation)
- [Usage](#usage)
- [Configuration](#configuration)
- [License](#license)

## Features

- All stats since boot are logged every 5 seconds, regardless if you are interacting with your Bitaxe or not
- When you wish to see how your Bitaxe has been performing, you just access this server and it will return a snapshot of various graphed stats
- It's as simple as running `node app.js` and letting it do its work. No manual intervention needed besides starting/stopping the server.

## Prerequisites

- Node.js - to run the server
- npm - to install server package dependencies
- jq - to parse JSON objects
- gnuplot - to plot the .csv data points
- montage - to combine all graphs into one image
- screen - to run the server detached from terminals

```bash
sudo apt install node npm jq gnuplot montage screen
```

## Installation

1. Clone the repository:
   ```bash
   git clone https://github.com/Katyatu/BitaxePersistentLogging.git
   cd BitaxePersistentLogging
   ```
2. Install dependencies:
   ```bash
   npm install
   ```
3. Create a `config.json` file in the project root (see [Configuration](#configuration)).

## Usage

1. Starting the server: `screen -S BPL node app.js` to start, then `CTRL+A, D` to detach
2. Accessing the server: `http://<serverLocalIP>:<serverPort>` (defined in `config.json`).
3. Stopping the server: `screen -r BPL` to reattach, and `CTRL+C` to gracefully stop

Note: Make sure your working directory is in the project root.

## Configuration

The server reads settings from `config.json` in the project root. Example:

```json
{
  "serverLocalIP": "192.168.x.xxx",
  "serverPort": "333x",
  "bitaxeLocalIP": "192.168.x.xxx"
}
```

- Copy `config.example.json` to `config.json` and update values as needed.

## License

See [LICENSE](LICENSE) for details.
